(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{Z0:()=>W,ip:()=>V,u3:()=>Q});var t=function(e,t){e.classList.add(t),e.disabled=!0},n=function(e,n,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?function(e,t){e.classList.remove(t),e.disabled=!1}(n,r):t(n,r)};function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=t.baseUrl,this._headers=t.headers}var t,n;return t=e,(n=[{key:"getClientInfo",value:function(){var e=this;return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((function(t){return e._getJsonOrReject(t,"Ошибка получения информации о пользователе")}))}},{key:"getCards",value:function(){var e=this;return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((function(t){return e._getJsonOrReject(t,"Ошибка получения карточек")}))}},{key:"likeCard",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then((function(e){return t._getJsonOrReject(e,"Ошибка лайка карточки")})).then((function(e){return e.likes.length}))}},{key:"unlikeCard",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return t._getJsonOrReject(e,"Ошибка удаления лайка карточки")})).then((function(e){return e.likes.length}))}},{key:"createCard",value:function(e,t){var n=this;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return n._getJsonOrReject(e,"Ошибка создания новой карточки")}))}},{key:"deleteCard",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return t._getJsonOrReject(e,"Ошибка удаления карточки")}))}},{key:"updateClientInfo",value:function(e,t){var n=this;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return n._getJsonOrReject(e,"Ошибка обновлении информации о пользователе")}))}},{key:"editAvatar",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((function(e){return t._getJsonOrReject(e,"Ошибка обновления аватара пользователя")}))}},{key:"_getJsonOrReject",value:function(e,t){return 200<=e.status&&e.status<300?e.json():Promise.reject(t+" ".concat(e.status,"."))}}])&&r(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function a(e){return e.createdAt=new Date(e.createdAt),e}function u(e,t){return t.createdAt-e.createdAt}function c(e,t){t.textContent=e?"Сохранение...":"Сохранить"}var i=document.querySelector(".popup_edit-profile"),l=i.querySelector(".popup__input_data_name"),s=i.querySelector(".popup__input_data_description"),d=i.querySelector(".popup__submit-button"),p=document.querySelector(".profile__info"),f=p.querySelector(".profile__name"),_=document.querySelector(".profile__avatar-image"),h=p.querySelector(".profile__description"),v=document.querySelector(".popup_add-card"),y=v.querySelector(".popup__input_data_name"),m=v.querySelector(".popup__input_data_link"),b=v.querySelector(".popup__submit-button"),S=document.querySelector(".popup_edit-avatar"),g=S.querySelector(".popup__input"),k=S.querySelector(".popup__submit-button"),q=document.querySelector(".profile__edit-button"),C=document.querySelector(".profile__avatar-edit-button"),E=document.querySelector(".profile__add-button"),L=document.querySelectorAll(".popup__close-button"),O=document.querySelector(".cards"),j=document.querySelector(".popup_image-view"),A=j.querySelector(".popup__image"),w=j.querySelector(".popup__image-caption"),x=document.querySelector("#card-template").content.querySelector(".card"),U="card__like_active",J={baseUrl:"https://mesto.nomoreparties.co/v1/".concat("plus-cohort-12"),headers:{authorization:"5374e37d-a100-45c2-9054-8042aa4bada1","Content-Type":"application/json"}};function P(e,t){var n;return e.querySelector(".card__likes-counter").textContent=(n=t)>1e3?Math.round(n/1e3*10)/10+"k":n>1e6?Math.round(n/1e6*10)/10+"m":n>1e9?Math.round(n/1e9*10)/10+"m":n,e}function R(e,t){return e.querySelector(".card__id").textContent=t,e}var T,I=function(e,t,n,r,o){var a=x.cloneNode(!0),u=a.querySelector(".card__image");return a.querySelector(".card__name").textContent=e,u.src=t,u.alt=e,a.querySelector(".card__like").addEventListener("click",(function(e){return n(e,a)})),a.querySelector(".card__delete").addEventListener("click",(function(e){return r(e,a)})),u.addEventListener("click",o),a},D=function(e){O.append(e)},B=function(e){O.prepend(e)},M=function(e){var t=e.target.classList.contains("popup__figure-container");e.target.classList.contains("popup__container")||t||z(e.target)},N=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");z(t)}},H=function(e){e.classList.add("popup_opened"),e.addEventListener("click",M),document.addEventListener("keydown",N)},z=function(e){e.classList.remove("popup_opened"),e.removeEventListener("click",M),document.removeEventListener("keydown",N)};function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}q.addEventListener("click",(function(){l.value=f.textContent,s.value=h.textContent,H(i)})),E.addEventListener("click",(function(){return H(v)})),L.forEach((function(e){return e.addEventListener("click",(function(e){z(e.target.closest(".popup"))}))})),i.querySelector(".popup__edit-area").addEventListener("submit",(function(e){return Q(e)})),v.querySelector(".popup__edit-area").addEventListener("submit",(function(e){return W(e)})),C.addEventListener("click",(function(){return H(S)})),S.querySelector(".popup__edit-area").addEventListener("submit",(function(e){return V(e)}));var $,F=new o(J),G=function(e,t){var n=t.querySelector(".card__id").textContent;(e.target.classList.contains(U)?F.unlikeCard.bind(F):F.likeCard.bind(F))(n).then((function(n){return function(e,t,n){e.target.classList.toggle(U),P(n,t)}(e,n,t)})).catch((function(){return"Ошибка при нажатии на лайк"}))},K=function(e,t){var n=t.querySelector(".card__id").textContent;F.deleteCard.call(F,n).then((function(){return e.target.closest(".card").remove()})).catch((function(){return console.error("Ошибка удаления карточки ".concat(n))})).catch((function(){return"Ошибка при удалении карточки"}))},Q=function(e){e.preventDefault(),c(!0,d),F.updateClientInfo.call(F,l.value,s.value).then((function(){f.textContent=l.value,h.textContent=s.value,z(e.target.closest(".popup"))})).catch((function(){return"Ошибка обновления информации о профиле"})).finally((function(){return c(!1,d)}))},V=function(e){e.preventDefault(),c(!0,k),F.editAvatar.call(F,g.value).then((function(){_.src=g.value,z(e.target.closest(".popup")),e.target.reset(),t(C,"popup__submit-button_inactive")})).finally((function(){return c(!1,k)}))},W=function(e){var n;e.preventDefault(),c(!0,b),F.createCard.call(F,y.value,m.value).then((function(e){return n=e._id,I(e.name,e.link)})).then((function(e){return R(e,n)})).then(B).then((function(){z(e.target.closest(".popup")),e.target.reset(),t(b,"popup__submit-button_inactive")})).catch("Ошибка добавления карточки").finally((function(){return c(!1,b)}))};Promise.all([F.getClientInfo(),F.getCards()]).then((function(e){var t,n,r,o,c,i=(c=2,function(e){if(Array.isArray(e))return e}(o=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],u=!0,c=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{u||null==n.return||n.return()}finally{if(c)throw o}}return a}}(o,c)||function(e,t){if(e){if("string"==typeof e)return Z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Z(e,t):void 0}}(o,c)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=i[0],s=i[1];T=l._id,t=l.avatar,n=l.name,r=l.about,f.textContent=n,h.textContent=r,_.src=t,(s=s.map(a).sort(u)).forEach((function(e){var t;(t=e.link,new Promise((function(e,n){var r=new Image;r.src=t,r.onload=e,r.onerror=n}))).then((function(){return I(e.name,e.link,G,K,(function(){return function(e,t){A.src=t,A.alt=e,w.textContent=e,H(j)}(e.name,e.link)}))})).then((function(t){return R(t,e._id)})).then((function(t){return P(t,e.likes.length)})).then((function(t){return function(e,t,n){return t.map((function(e){return e._id})).includes(n)&&e.querySelector(".card__like").classList.add("card__like_active"),e}(t,e.likes,T)})).then((function(t){return function(e,t){return t||e.querySelector(".card__delete").remove(),e}(t,e.owner._id===T)})).then(D).catch((function(){return console.error("Изображение ".concat(e.name," по ссылке ").concat(e.link," не доступно."))}))}))})),$={formSelector:".popup__edit-area",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_visible"},Array.from(document.querySelectorAll($.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){return e.preventDefault()})),function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n(r,o,t.inactiveButtonClass),r.forEach((function(a){return a.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,a,t),n(r,o,t.inactiveButtonClass)}))}))}(e,$)}))})();